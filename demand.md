---
title: "Demand PS 1"
author: "Doron Zamir"
date: "6/5/2021"
output:
  html_document: 
    html_preview: yes
    toc: yes
    toc_float: yes
    code_folding: show
    keep_md: yes
    df_print: tibble
---

# Part 1 - A simple Logit Model

## 1. Specifying a Model

I will be estimating demand elasticities in the European Car Market, following *Goldberg and Verboven (2001)* and using the same database, and using the methods introduced by *Berry (1994)*.

The underlying utility function in the base of the model is this:

$$
u_{jti} = \delta_{jt} +\mu_{ijt} +\xi_{jt} 
$$

That is, the utility of the consumer $i$ from consuming one unit of car $j$ in market $t$ contains of three components: $\delta_{jt}$ is a common to all consumers,$\mu_{jti}$ is set on the individual level, and $\xi_{jt}$ is a vector of unobserved(to the researcher) characteristics.

Since we are interested in the common / average component, write $\delta_{jt}$ explicitly:

$$
\delta_{jt} = \beta x_{jt} + \alpha p_{jt}
$$

And the individual level $\mu_{ijt}$ :

$$
\mu_{ijt} = \sum_{l= 1}^k{\sigma_lv_{il}x_{jl}} +\sigma_pv_{ip}p_j +\epsilon_{ij}
$$

I defined the markets $t =1â€¦..T$ to be the interaction between state and year, that is $t \in stateXyear$. The period segmentation is due to the fact that car models differs by the year of production that is, car model $j$ is not the same in time $t$ and in time $t'$; It is a different product, and consumers will assign different utility from it. The state level segmentation is due to the fact that in the time of the sample, the different countries functions as different markets, with different preferences upon attributes of the car, different macro conditions, different distribution lines for the producers, etc.

Suppressing the market index for now on, the car observable characteristics vector $x_j$, used as utility shifter, is set to be the following:

-   brand and model fixed effects for capturing flavors and brand loyalty

-   whether a car is domestically produced or not

-   physical characteristics of the car: weight, places, door, length, width etc.

-   technical characteristics : horsepower, fuel efficiency (in three different speeds), acceleration, max speed etc.

I did not use class dummy, as the the physical characteristics, and the interactions between the later and brand and model fixed effects, explains much of the utility might be explained by class.

Following to what we did class, estimate the following equation:

$$
ln(s_{jt}) - ln(s_{0t})  = \beta x_{jt} + \alpha p_{jt}
$$

where $s_{jt}$ is the market share of product $j$ in market $t$ :

$$
s_{jt} \equiv \frac{q_{jt}}{M_t} 
$$

$M_t$ is the market size, here taken to be the population of the country in the specific year, and the outside product $j = 0$ is set to be "not buying a new car", that is we don't know what did the people consumed the outside product did: they might stayed with their old car, bought a second - hand car or stick with public transportation.

### 1.1 Getting thing ready

#### Loading Packages

``` {.r .fold-hide}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(
  tidyverse,
  broom,
  AER,
  miceadds,
  estimatr
)
```

#### Loading the dataset

I used `read.dta` from `foreign` package to read the stata file, including labels.

``` {.r}
df_raw <- foreign::read.dta(
  "Data/cars.dta"
)

head(df_raw)
```

    ## # A tibble: 6 x 47
    ##      ye ma        co zcode brd   type  brand model   org loc   cla    home frm  
    ##   <int> <fct>  <int> <int> <fct> <chr> <chr> <chr> <int> <fct> <fct> <int> <fct>
    ## 1    83 Belgi~     1     5 Alfa~ alfa~ alfa~ 33        3 Italy comp~     0 Alfa~
    ## 2    84 Belgi~     1     5 Alfa~ alfa~ alfa~ 33        3 Italy comp~     0 Alfa~
    ## 3    85 Belgi~     1     5 Alfa~ alfa~ alfa~ 33        3 Italy comp~     0 Alfa~
    ## 4    86 Belgi~     1     5 Alfa~ alfa~ alfa~ 33        3 Italy comp~     0 Alfa~
    ## 5    87 Belgi~     1     5 Alfa~ alfa~ alfa~ 33        3 Italy comp~     0 Fiat 
    ## 6    88 Belgi~     1     5 Alfa~ alfa~ alfa~ 33        3 Italy comp~     0 Fiat 
    ## # ... with 34 more variables: qu <dbl>, cy <dbl>, hp <dbl>, we <int>, pl <dbl>,
    ## #   do <dbl>, le <dbl>, wi <dbl>, he <dbl>, li1 <dbl>, li2 <dbl>, li3 <dbl>,
    ## #   li <dbl>, sp <dbl>, ac <dbl>, pr <dbl>, princ <dbl>, eurpr <dbl>,
    ## #   exppr <dbl>, avexr <dbl>, avdexr <dbl>, avcpr <dbl>, avppr <dbl>,
    ## #   avdcpr <dbl>, avdppr <dbl>, xexr <dbl>, tax <dbl>, pop <dbl>, ngdp <dbl>,
    ## #   rgdp <dbl>, engdp <dbl>, ergdp <dbl>, engdpc <dbl>, ergdpc <dbl>

#### Preparing the data

First, drop unneeded attributes:

``` {.r}
df <- df_raw %>% 
  select(-c(
    co,
    brd,
    cla,
    pr,
    princ,
    exppr,
  ))
```

Create market identification, where, as mentioned, markets are set to be a combination of year and country:

``` {.r}
df <- df %>% mutate(
  mkt = as_factor(str_c(ma,ye, sep = "_"))
)

df %>% select(mkt) %>% sample_n(8)
```

    ## # A tibble: 8 x 1
    ##   mkt       
    ##   <fct>     
    ## 1 Belgium_92
    ## 2 Germany_78
    ## 3 Germany_74
    ## 4 UK_92     
    ## 5 France_73 
    ## 6 Belgium_93
    ## 7 UK_90     
    ## 8 Italy_83

Calculate market shares, creating variable name `s_j` to be the market share of product `j`.

``` {.r}
df <- df %>% mutate(
  s_j = qu / pop
)
```

adding the outside product market share `s_0`, calculated as $s_{j0} \equiv 1- \sum_{j = 1}^J (s_{jt})$

``` {.r}
df <- df %>% 
  group_by(mkt) %>% 
  mutate(
    s_0 = 1 - sum (s_j)
  ) %>% ungroup()
```

Now, creating our dependent variable for the regression

$$
\Delta ln(s_j) \equiv \ln(s_j) - ln(s_0) 
$$

call it `dln_s`:

``` {.r}
df <- df %>% 
  mutate(dln_s = log(s_j) - log(s_0))
```

showing the main variables of the regression (without $x_j$ ), i.e $(\Delta ln(s_{tj}), p_{jt})$

``` {.r}
df %>% select(
  mkt,
  brand,
  model,
   dln_s,
  eurpr
)
```

    ## # A tibble: 11,549 x 5
    ##    mkt        brand      model dln_s eurpr
    ##    <fct>      <chr>      <chr> <dbl> <dbl>
    ##  1 Belgium_83 alfa romeo 33    -9.48 6078.
    ##  2 Belgium_84 alfa romeo 33    -8.54 5859.
    ##  3 Belgium_85 alfa romeo 33    -8.59 6126.
    ##  4 Belgium_86 alfa romeo 33    -8.44 6559.
    ##  5 Belgium_87 alfa romeo 33    -8.39 7272.
    ##  6 Belgium_88 alfa romeo 33    -8.42 7527.
    ##  7 Belgium_89 alfa romeo 33    -8.57 8282.
    ##  8 Belgium_90 alfa romeo 33    -8.17 9353.
    ##  9 Belgium_91 alfa romeo 33    -8.11 9128.
    ## 10 Belgium_92 alfa romeo 33    -8.12 9138.
    ## # ... with 11,539 more rows

## 2. OLS Estimation

estimating our model equation using OLS:

$$
\Delta ln(s_j) = \beta x_{jt} + \alpha p_{jt}
$$

Where $\alpha$ is our parameter of interest, and $p_{jt}$ is given in common currency, as `eurpr`.

``` {.r}
ols_model <- lm_robust(
  dln_s ~ eurpr + cy + home + hp + we + as.factor(pl) + as.factor(do) + he + li1 + li2 +li3 +li+sp + ac ,
  data = df,
  se_type = "stata",
  clusters = ma,
  fixed_effects = ~  brand + model
)

tidy(ols_model$coefficients)
```

    ## # A tibble: 26 x 2
    ##    names                     x
    ##    <chr>                 <dbl>
    ##  1 eurpr            -0.0000625
    ##  2 cy               -0.000650 
    ##  3 home              1.59     
    ##  4 hp               -0.0264   
    ##  5 we                0.000687 
    ##  6 as.factor(pl)3    1.03     
    ##  7 as.factor(pl)4    0.225    
    ##  8 as.factor(pl)4.5  0.291    
    ##  9 as.factor(pl)5    0.152    
    ## 10 as.factor(pl)5.5 -0.269    
    ## # ... with 16 more rows

``` {.r}
alpha_ols  <-  ols_model$coefficients["eurpr"]
alpha_ols
```

    ##         eurpr 
    ## -6.246557e-05

## 3. IV Estimation

### 3.1 Choosing IV

The OLS estimator is inefficient, due to simultaneity problem.

I will use an IV suggested by *Goldberg and Verboven (2001)*: the exchange rate between origin and destination, this is stored in the variable `xexr`.

The exchange rate differences affects pricing only throw the supply curve, and are suggested to be valid instrument.

Another instrument that I will use, is the "producer price index" (`avppr)` of exporter country, affecting costs of the producer, but not the consumer.

### 3.2 TSLS estimation

``` {.r}
iv_model <- iv_robust(
  dln_s ~ eurpr + cy + home + hp + we + as.factor(pl) + as.factor(do) + he + li1 + li2 +li3 +li+sp + ac | . -eurpr + xexr ,
  data = df,
  se_type = "stata",
  clusters = ma,
  fixed_effects = ~  brand + model
)
summary(iv_model)
```

    ## 
    ## Call:
    ## iv_robust(formula = dln_s ~ eurpr + cy + home + hp + we + as.factor(pl) + 
    ##     as.factor(do) + he + li1 + li2 + li3 + li + sp + ac | . - 
    ##     eurpr + xexr, data = df, clusters = ma, fixed_effects = ~brand + 
    ##     model, se_type = "stata")
    ## 
    ## Standard error type:  stata 
    ## 
    ## Coefficients: (13 not defined because the design matrix is rank deficient)
    ##                                 Estimate Std. Error  t value Pr(>|t|)
    ## eurpr                         -0.0009595   0.001281 -0.74902  0.49549
    ## cy                             0.0014454   0.017475  0.08272  0.93805
    ## home                           1.9486298   1.466241  1.32900  0.25459
    ## hp                             0.2922759   0.321446  0.90925  0.41465
    ## we                            -0.0088757   0.050770 -0.17482  0.86971
    ## as.factor(pl)3                        NA         NA       NA       NA
    ## as.factor(pl)4                        NA         NA       NA       NA
    ## as.factor(pl)4.5                      NA         NA       NA       NA
    ## as.factor(pl)5                        NA         NA       NA       NA
    ## as.factor(pl)5.5                      NA         NA       NA       NA
    ## as.factor(pl)5.59999990463257         NA         NA       NA       NA
    ## as.factor(pl)5.69999980926514         NA         NA       NA       NA
    ## as.factor(pl)5.80000019073486         NA         NA       NA       NA
    ## as.factor(pl)6                        NA         NA       NA       NA
    ## as.factor(do)3                 7.5745226  14.630516  0.51772  0.63197
    ## as.factor(do)3.5                      NA         NA       NA       NA
    ## as.factor(do)4                        NA         NA       NA       NA
    ## as.factor(do)4.5                      NA         NA       NA       NA
    ## as.factor(do)5                 5.8049203  14.136291  0.41064  0.70238
    ## he                             1.0267106   4.356511  0.23567  0.82526
    ## li1                           -2.2644174   0.861247 -2.62923  0.05823
    ## li2                            5.9580458   7.483180  0.79619  0.47050
    ## li3                           -6.2250428   6.793245 -0.91636  0.41133
    ## li                                    NA         NA       NA       NA
    ## sp                             0.1526308   1.395743  0.10935  0.91819
    ## ac                             0.4191179   0.681372  0.61511  0.57175
    ##                                 CI Lower  CI Upper DF
    ## eurpr                          -0.004516  0.002597  4
    ## cy                             -0.047072  0.049963  4
    ## home                           -2.122308  6.019568  4
    ## hp                             -0.600202  1.184754  4
    ## we                             -0.149835  0.132084  4
    ## as.factor(pl)3                        NA        NA NA
    ## as.factor(pl)4                        NA        NA NA
    ## as.factor(pl)4.5                      NA        NA NA
    ## as.factor(pl)5                        NA        NA NA
    ## as.factor(pl)5.5                      NA        NA NA
    ## as.factor(pl)5.59999990463257         NA        NA NA
    ## as.factor(pl)5.69999980926514         NA        NA NA
    ## as.factor(pl)5.80000019073486         NA        NA NA
    ## as.factor(pl)6                        NA        NA NA
    ## as.factor(do)3                -33.046303 48.195348  4
    ## as.factor(do)3.5                      NA        NA NA
    ## as.factor(do)4                        NA        NA NA
    ## as.factor(do)4.5                      NA        NA NA
    ## as.factor(do)5                -33.443717 45.053557  4
    ## he                            -11.068903 13.122324  4
    ## li1                            -4.655623  0.126788  4
    ## li2                           -14.818592 26.734684  4
    ## li3                           -25.086114 12.636028  4
    ## li                                    NA        NA NA
    ## sp                             -3.722573  4.027834  4
    ## ac                             -1.472673  2.310909  4
    ## 
    ## Multiple R-squared:  -10.75 ,    Adjusted R-squared:  -11.28
    ## Multiple R-squared (proj. model):  -23.29 ,  Adjusted R-squared (proj. model):  -24.38 
    ## F-statistic (proj. model):    NA on 13 and 4 DF,  p-value: NA

``` {.r}
alpha_iv <- iv_model$coefficients["eurpr"]
alpha_iv
```

    ##         eurpr 
    ## -0.0009595408

### 3.3 Discussion

The 2SLS estimation for $\alpha$ is lower (i.e more negative) than the OLS one. This is in line with the intuitive that the OLS estimator is biased closer to zero due to simultaneity of the price variable.

## 3. Estimating price elasticities:

Using $\alpha^{IV}$ we can estimate the elasticities.

let $H$ be a price elasticities matrix, where $\eta_{jk}$ set to be the price elasticity between products $j,k$, That is:

$$
\eta_{j_k} \equiv \frac{\partial s_j}{\partial p_k}\cdot \frac{p_j}{s_k} = \begin{cases}\alpha p_j(1-s_j) & k = j \\ -\alpha p_k s_k & k \ne j \end{cases}$$

I will select market `UK_70:`

``` {.r}
UK_70 <- df %>% 
  filter(mkt == "UK_70")

J = nrow(UK_70)
J
```

    ## [1] 40

calculate elasticities:

``` {.r}
ETA <- matrix(0,J,J)

for (j in 1:J) {
  for (k in 1:J) {
    if (j == k){
      ETA[j,k] <-as.numeric(alpha_iv  * UK_70[k,"eurpr"]* (1- UK_70[k,"s_j"]))
      }
    else{
      ETA[j,k] = as.numeric(-alpha_iv * UK_70[k,"s_j"] * UK_70[k,"eurpr"])
  }
  }
}
formatC(ETA, digits = 4,format= "f")
```

    ##       [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]     
    ##  [1,] "-1.8803" "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ##  [2,] "0.0002"  "-1.6776" "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ##  [3,] "0.0002"  "0.0029"  "-1.9796" "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ##  [4,] "0.0002"  "0.0029"  "0.0044"  "-5.9219" "0.0000"  "0.0001"  "0.0001" 
    ##  [5,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "-1.7885" "0.0001"  "0.0001" 
    ##  [6,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "-2.9908" "0.0001" 
    ##  [7,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "-1.3447"
    ##  [8,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ##  [9,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [10,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [11,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [12,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [13,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [14,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [15,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [16,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [17,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [18,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [19,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [20,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [21,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [22,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [23,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [24,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [25,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [26,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [27,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [28,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [29,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [30,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [31,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [32,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [33,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [34,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [35,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [36,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [37,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [38,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [39,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ## [40,] "0.0002"  "0.0029"  "0.0044"  "0.0002"  "0.0000"  "0.0001"  "0.0001" 
    ##       [,8]      [,9]      [,10]     [,11]     [,12]     [,13]     [,14]    
    ##  [1,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##  [2,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##  [3,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##  [4,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##  [5,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##  [6,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##  [7,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##  [8,] "-2.2734" "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##  [9,] "0.0003"  "-1.6895" "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [10,] "0.0003"  "0.0002"  "-1.9999" "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [11,] "0.0003"  "0.0002"  "0.0002"  "-1.4233" "0.0017"  "0.0016"  "0.0001" 
    ## [12,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "-3.7111" "0.0016"  "0.0001" 
    ## [13,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "-2.3387" "0.0001" 
    ## [14,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "-2.1816"
    ## [15,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [16,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [17,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [18,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [19,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [20,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [21,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [22,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [23,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [24,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [25,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [26,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [27,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [28,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [29,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [30,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [31,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [32,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [33,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [34,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [35,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [36,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [37,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [38,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [39,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ## [40,] "0.0003"  "0.0002"  "0.0002"  "0.0021"  "0.0017"  "0.0016"  "0.0001" 
    ##       [,15]     [,16]     [,17]     [,18]     [,19]     [,20]     [,21]    
    ##  [1,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##  [2,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##  [3,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##  [4,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##  [5,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##  [6,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##  [7,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##  [8,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##  [9,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [10,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [11,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [12,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [13,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [14,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [15,] "-2.5838" "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [16,] "0.0001"  "-1.8368" "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [17,] "0.0001"  "0.0001"  "-1.8536" "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [18,] "0.0001"  "0.0001"  "0.0017"  "-2.9862" "0.0002"  "0.0001"  "0.0002" 
    ## [19,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "-3.6413" "0.0001"  "0.0002" 
    ## [20,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "-1.5631" "0.0002" 
    ## [21,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "-2.1263"
    ## [22,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [23,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [24,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [25,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [26,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [27,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [28,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [29,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [30,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [31,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [32,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [33,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [34,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [35,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [36,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [37,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [38,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [39,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ## [40,] "0.0001"  "0.0001"  "0.0017"  "0.0001"  "0.0002"  "0.0001"  "0.0002" 
    ##       [,22]     [,23]     [,24]     [,25]     [,26]     [,27]     [,28]    
    ##  [1,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##  [2,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##  [3,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##  [4,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##  [5,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##  [6,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##  [7,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##  [8,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##  [9,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [10,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [11,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [12,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [13,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [14,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [15,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [16,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [17,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [18,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [19,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [20,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [21,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [22,] "-2.7563" "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [23,] "0.0002"  "-1.1448" "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [24,] "0.0002"  "0.0001"  "-1.4919" "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [25,] "0.0002"  "0.0001"  "0.0001"  "-2.2777" "0.0006"  "0.0001"  "0.0012" 
    ## [26,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "-2.4638" "0.0001"  "0.0012" 
    ## [27,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "-2.7907" "0.0012" 
    ## [28,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "-2.3943"
    ## [29,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [30,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [31,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [32,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [33,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [34,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [35,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [36,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [37,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [38,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [39,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ## [40,] "0.0002"  "0.0001"  "0.0001"  "0.0006"  "0.0006"  "0.0001"  "0.0012" 
    ##       [,29]     [,30]     [,31]     [,32]     [,33]     [,34]     [,35]    
    ##  [1,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##  [2,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##  [3,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##  [4,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##  [5,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##  [6,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##  [7,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##  [8,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##  [9,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [10,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [11,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [12,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [13,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [14,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [15,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [16,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [17,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [18,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [19,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [20,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [21,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [22,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [23,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [24,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [25,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [26,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [27,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [28,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [29,] "-1.7310" "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [30,] "0.0024"  "-1.6527" "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [31,] "0.0024"  "0.0002"  "-1.7659" "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [32,] "0.0024"  "0.0002"  "0.0042"  "-2.5756" "0.0004"  "0.0011"  "0.0000" 
    ## [33,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "-1.6112" "0.0011"  "0.0000" 
    ## [34,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "-3.4472" "0.0000" 
    ## [35,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "-1.9563"
    ## [36,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [37,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [38,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [39,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ## [40,] "0.0024"  "0.0002"  "0.0042"  "0.0015"  "0.0004"  "0.0011"  "0.0000" 
    ##       [,36]     [,37]     [,38]     [,39]     [,40]    
    ##  [1,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ##  [2,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ##  [3,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ##  [4,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ##  [5,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ##  [6,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ##  [7,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ##  [8,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ##  [9,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [10,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [11,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [12,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [13,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [14,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [15,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [16,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [17,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [18,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [19,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [20,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [21,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [22,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [23,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [24,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [25,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [26,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [27,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [28,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [29,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [30,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [31,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [32,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [33,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [34,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [35,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [36,] "-1.5609" "0.0004"  "0.0004"  "0.0016"  "0.0005" 
    ## [37,] "0.0001"  "-1.3951" "0.0004"  "0.0016"  "0.0005" 
    ## [38,] "0.0001"  "0.0004"  "-2.2985" "0.0016"  "0.0005" 
    ## [39,] "0.0001"  "0.0004"  "0.0004"  "-2.3617" "0.0005" 
    ## [40,] "0.0001"  "0.0004"  "0.0004"  "0.0016"  "-3.5674"

The results does not make sense, in the matter that the cross elasticity of a product doe's not differ across products, just uppon prices.

# Part 2 - Using a RCM

## 1. Specifying a Model

Again, we are in a world where consumers $i$ from car $j$ in market $t$ is specified by

$$
u_{jti} = \delta_{jt} +\mu_{ijt} +\xi_{jt} 
$$

Where $$
\delta_{jt} = \beta x_{jt} + \alpha p_{jt}
$$

And

$$
\mu_{ijt} = \sum_{l= 1}^k{\sigma_lv_{il}x_{jl}} +\sigma_pv_{ip}p_j +\epsilon_{ij}
$$

For simplicity, I will assume that only two characteristics have random coefficients: price and fuel efficacy.

so define
